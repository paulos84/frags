{% extends "base_bioactive_generic.html" %}
{% load bootstrap3 %}
{% load static %}

{% block title %}
    <title>{{ bioactive }}</title>
{% endblock %}

{% block head %}
     <link rel="stylesheet" href="{% static 'css/bioactive.css' %}">
     <script src="http://3Dmol.csb.pitt.edu/build/3Dmol-min.js"></script>
{% endblock %}

{% block content %}
<div class="col-sm-6 " style="position: relative; left:20px; ">
    {% if bioactive.chemical_name %}
        <h4 class="intro">{{ bioactive }}</h4>
        <h5 class="intro">{{ bioactive.iupac_name }}</h5>
    {% else %}
        <h5 class="intro">{{ bioactive.iupac_name }}</h5>
    {% endif %}
    <p><strong>SMILES:</strong> {{ bioactive.smiles }}</p>
    <p><strong>InChIKey:</strong> {{ bioactive.inchikey }}</p>
    <div class="btn-group" role="group" style="margin-top:4px; ">
        <a href="{% url 'literature-references' pk=bioactive.pk compound_type='bioactive' %}">
            <button style="width: 170px; background-color: #f6f6f6; " type="button" class="btn btn-secondary">Literature references</button></a>
        <a href="{% url 'user-compound-sources'  pk=bioactive.pk compound_type='bioactive' %}">
           <button type="button" style=" background-color: #f6f6f6; " class="btn btn-secondary" >
           <span class="glyphicon glyphicon"></span>Saved sources</button>
        </a>
        <a href="{% url 'available-sources'  pk=bioactive.pk compound_type='bioactive' %}">
           <button type="button" style=" background-color: #f6f6f6; " class="btn btn-secondary" >
           <span class="glyphicon glyphicon"></span>Available sources</button>
        </a>
    </div>
    <div class="btn-group" role="group" style="margin-top:14px; ">
        <button type="button" class="btn btn-secondary" style="color: #6aaf6a; "
                onclick="$('#chem_properties_table').toggle();
                $('#substructure_matches').hide();
                $('#user_data_table').hide();
                $('#3dmol-viewer').hide() ">
            Chemical properties</button>
        {% if user.is_authenticated %}
        <button type="button" class="btn btn-secondary" style="color: #6aaf6a; "
                onclick="$('#user_data_table').toggle();
                $('#substructure_matches').hide();
                $('#chem_properties_table').hide();
                $('#3dmol-viewer').hide() ">
            Saved data</button>
        {% else %}
        <button type="button" class="btn btn-secondary" style="color: #6aaf6a; " disabled>Saved data</button>
        {% endif %}
        <button type="button" class="btn btn-secondary" style="color: #6aaf6a; "
                onclick="$('#substructure_matches').toggle();
                $('#chem_properties_table').hide();
                $('#user_data_table').hide();
                $('#3dmol-viewer').hide() ">
            Substructures</button>
        <button type="button" class="btn btn-secondary" style="color: #6aaf6a;  "
                onclick="$('#3dmol-viewer').toggle();
                 $('#chem_properties_table').hide();
                 $('#substructure_matches').hide();
                 $('#user_data_table').hide() ">
            3D Model</button>
    </div>
        <div id="user_data_table" style="display: none; width: 320px">
            <form id="remove_form" method="post">
            {% csrf_token %}
            <table class="table" style="width: 500px">
            {% for key, value in user_data.items|dictsort:"0.lower" %}
                <tr>
                    <td><input type="checkbox" name="remove_data" value={{ key }}></td>
                    <td width="220"><strong>{{ key }}</strong>: </td>
                    <td> {{ value }}</td>
                </tr>
            {% endfor %}
            </table>
            </form>
            <button type="button" id="show_form_button" class="btn btn-secondary" style="color: #6aaf6a; ">Add data</button>
            <div id="add_data_form" style="display: none">
                <h5><strong>Add data</strong></h5>
                <form method="post">
                    {% csrf_token %}
                    {% bootstrap_form form %}
                        <button type="submit" class="btn btn-success"><span class="glyphicon glyphicon-ok">
                            </span>Submit</button>
                </form>
            </div>
            <button form="remove_form" type="submit" class="btn btn-secondary">
                <span class="glyphicon glyphicon-remove"></span>Remove selection</button>
        </div>
        <div id="chem_properties_table" style="display: none">
            <table class="table" style="width: 290px">
            {% for key, value in chemical_properties.items|dictsort:"0.lower" %}
                <tr>
                    <td width="220"><strong>{{ key }}</strong>: </td><td> {{ value }}</td>
                </tr>
            {% endfor %}
            </table>
        </div>
        <div id="substructure_matches" style="display: none; margin-top: 44px;  ">
        {% if substructures %}
            {% for substruct in substructures %}
                <div class="structure-img"><a href="{{ substruct.get_absolute_url }}">
                    <img src={{ substruct.structure_url }} height="150" width="150" title={{ substruct }} >
                    <div style="position: relative; left:30px; margin-top:7px; ">
                                <a href="{{ substruct.get_absolute_url }}">{{ substruct }}</a></div>
            </a></div>
            {% endfor %}
        {% endif %}
        </div>
        <div style="height: 300px; width: 300px; position: relative; left: 30px; " id="3dmol-viewer"
             class='viewer_3Dmoljs' data-cid={{ cid_string }} data-backgroundcolor='0xffffff' data-style='stick'>
        </div>
</div>

<div class="col-sm-4 ">
    <div style="float:left; position:relative; top:2px" class="structure-img">
        <img width="220" height="220" class="structure-img" src={{ bioactive.structure_url }} title={{substructure}} >
    </div>
    <div style=" position:relative; top:24px; width:280px; left:12px">
        <p><strong>Synonyms:</strong> {{ bioactive.synonyms|truncatechars:124 }}</p>
    </div>
    {% if bioactive.activity %}
    <div style=" position:relative; top:24px; width:280px; left:12px">
        <p><strong>Classification:</strong> {{ bioactive.activity.get_classification_display }}</p>
    </div>
    {% endif %}
    {% if bioactive.action %}
    <div style=" position:relative; top:24px; width:280px; left:12px">
        <p><strong>Action:</strong> {{ bioactive.action }}</p>
    </div>
    {% endif %}
    {% if bioactive.mechanism %}
    <div style=" position:relative; top:24px; width:280px; left:12px">
        <p><strong>Mechanism:</strong> {{ bioactive.mechanism }}</p>
    </div>
    {% endif %}
</div>

<div class="col-sm-10 " style="margin-top:10px">
        {% if user.is_authenticated %}
        <div id="user-notes" style="width: 460px">
        {% if user_notes %}
            <div><p><strong>My notes</strong></div>
            {{ user_notes }}
        </div>
        <div id="notes-form" style="display: none; width: 460px">
            <form method="post">
            {% csrf_token %}
            {% bootstrap_form form2 %}
                <button type="submit"  class="btn btn-primary" >
                <span class="glyphicon glyphicon"></span>Submit</button>
            </form>
        </div>
        <div style="position: relative; top: 13px; width:400px;">
            <div style="float: left; width: 80px; ">
                <button type="button"  id="show-odor" class="btn btn-secondary" style="color: #6aaf6a"
                        onclick="$('#user-notes, #notes-form').toggle();">
                Edit</button></div>
            <form method="POST" action="{% url 'user-notes-delete' model='bioactive' pk=user_notes_pk %}" >
                {% csrf_token %}
                <button type="submit"  class="btn btn-secondary" onclick="return confirm('Are you sure?');" style="color: #6aaf6a">
                <span class="glyphicon glyphicon"></span>Delete</button>
            </form>
        </div>
        </div>
    {% else %}
        <form method="post" style="width: 460px">
          {% csrf_token %}
          {% bootstrap_form form2 %}
        <button type="submit"  class="btn btn-primary" >
            <span class="glyphicon glyphicon"></span>Submit</button>
        </form>
    {% endif %}
    {% else %}
            <form method="post" novalidate>
              {% csrf_token %}
              {% bootstrap_form form2 %}
            <button type="submit" class="btn btn-primary" disabled>
                <span class="glyphicon glyphicon"></span>Submit</button>
            </form>
    {% endif %}
</div>
{% endblock %}

{% block js %}
<script>
        $(function(){
            $("#show_form_button").on('click',function() {
                $(this).hide();
                $("#add_data_form").show();
            });
        });
    </script>
{% endblock %}
