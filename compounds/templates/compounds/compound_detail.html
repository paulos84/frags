{% extends "base_generic.html" %}
{% load bootstrap3 %}
{% load static %}
{% block title %}
    {% if compound.trade_name %}
    <title>{{ compound.trade_name }}</title>
    {% else %}
    <title>{{ compound.iupac_name }}</title>
    {% endif %}
{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{% static 'css/substructure.css' %}">
{% endblock %}
{% block content %}
    <div class="col-sm-5 ">
         <h4 class="intro">{{ compound.iupac_name }}</h4>
        {% if compound.trade_name %}
            <p><strong>Trade name:</strong> {{ compound.trade_name }}</p>
        {% endif %}
        <p><strong>CAS number:</strong> {{ compound.cas_number }}</a></p>
        <p><strong>SMILES:</strong> {{ compound.smiles }}</p>
        {% if compound.odor_types %}
          <p><strong>Odor types: </strong>{{ compound.odor_types }}</p>
        {% endif %}
        {% if odor_types %}
             <p><strong>Odor categories: </strong>{{ odor_types }}</p>
        {% endif %}
        {% if compound.odor_description %}
            <p><strong>Odor description:</strong> {{ compound.odor_description }}</p>
        {% endif %}
        {% if form2 %}
            <form method="post">
            {% csrf_token %}
            {% bootstrap_form form2 %}
                {% if user.is_authenticated %}
                <button type="submit"  class="btn btn-primary" >
                <span class="glyphicon glyphicon"></span>Submit</button>
                {% else %}
                <button type="submit"  class="btn btn-primary" disabled>
                <span class="glyphicon glyphicon"></span>Submit</button>
                {% endif %}
            </form>
        {% elif compound.created_by == request.user.profile or request.user.is_superuser %}
            <a href="{% url 'compound-update' pk=compound.pk %}">
            <button type="button" class="btn btn-secondary">Edit</button></a>
        {% else %}
            <a href="{% url 'compound-update' pk=compound.pk %}">
            <button type="button" class="btn btn-secondary" disabled>Edit</button></a>
        {% endif %}
        </div>
    <div class="col-sm-5 ">
        <div style=" position:relative; top:16px">
            <img class="structure-img" src={{ compound.structure_url }} title={{substructure}} >
        </div>
        <div style=" position:relative; top:24px; width:320px; left:24px">
            <p><strong>Synonyms:</strong> {{ compound.synonyms|truncatechars:132 }}</p>
        </div>
    </div>
    <div class="col-sm-10 " style="margin-top:10px">
        {% if substructures %}
            <p><strong>Structural fragments</strong>
            {% for substruct in substructures %}
                <a href="{{ substruct.get_absolute_url }}">
                    <img src={{ substruct.structure_url }} height="120" width="120" title={{ substruct }} >
            </a></p>
            {% endfor %}
        {% endif %}
        <br>
        {% if user.is_authenticated %}
        <div id="user-notes">
        {% if user_notes %}
            <div><p><strong>My notes</strong></div>
            {{ user_notes }}
        </div>
        <div id="notes-form" style="display: none;">
            <form method="post">
            {% csrf_token %}
            {% bootstrap_form form %}
                <button type="submit"  class="btn btn-primary" >
                <span class="glyphicon glyphicon"></span>Submit</button>
            </form>
        </div>
        <div style="position: relative; top: 13px; width:400px;">
            <div style="float: left; width: 130px; ">
                <button type="button"  id="show-odor" class="btn btn-secondary" style="color: #6aaf6a"
                        onclick="$('#user-notes, #notes-form').toggle();">
                Edit</button></div>
             </div>
        <div style="float: right; width: 155px; ">
            <form method="POST" action="{% url 'user-notes-delete' pk=user_notes_pk %}" >
                {% csrf_token %}
                <button type="submit"  class="btn btn-secondary" onclick="return confirm('Are you sure?');"
                    style="width: 150px; background-color: #fbfcfb; ">
                <span class="glyphicon glyphicon"></span>Delete</button>
            </form>
        </div>
        </div>
    {% else %}
        <form method="post">
          {% csrf_token %}
          {% bootstrap_form form %}
        <button type="submit"  class="btn btn-primary" >
            <span class="glyphicon glyphicon"></span>Submit</button>
        </form>
    {% endif %}
    {% else %}
            <form method="post" novalidate>
              {% csrf_token %}
              {% bootstrap_form form %}
            <button type="submit" class="btn btn-primary" disabled>
                <span class="glyphicon glyphicon"></span>Submit</button>
            </form>
    {% endif %}
</div>
{% endblock %}
