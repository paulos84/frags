{% extends "base_generic.html" %}
{% load static %}
{% block title %}<title>Add Compound</title>{% endblock %}
{% block head %}
  <script src='https://www.google.com/recaptcha/api.js'></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
{% endblock %}
{% block content %}
  <div class="col-sm-5 ">
    <form id="add-compound-form" action="" method="post"  enctype="multipart/form-data">
      {% csrf_token %}
      <table border="1">
        {% for field in form.visible_fields %}
        <tr><th>
          {{ field.label_tag }}
          {% if field.field.required %}
              <span class="special_class">*</span>
          {% endif %}
          </th>
        <td>
        {{ field }}
        {{ field.errors }}
        </td></tr>
      {% endfor %}
      {% for field in form.hidden_fields %}
          {{ field }}
      {% endfor %}
      </table>
      <div class="g-recaptcha" data-sitekey="6LfiTVsUAAAAAGk3OxDhpYLIsMJmzxNvljEePwkz"></div>
      <script src='https://www.google.com/recaptcha/api.js'></script>
     <button type="submit" class="btn-submit">Submit</button>
    </form>
     <ul class="errorlist">
    {% for key, value in form.errors.items %}
    <li>{% if key != '__all__' %}{{ key }} {% endif %}{{ value }}</li>
    {% endfor %}
</ul>
  </div>
    <div class="col-sm-5 ">
        <p>IUPAC name: <input type='text' name='text' id='iupac_name' size="80" ></p>
    <div id="object_exists" style=" display: none; position:absolute; left:13px; top:50px; width:300px; height:200px;">
      <h5>Compound exists in database: </h5>
        <ul class="sidebar-nav">
          <li><a href="{% url 'index' %}">Compounds index</a></li>
      </ul>
    </div>
    <div style="text-align:left">
        <img id="compound_structure" src="" border="1">
    </div>
  </div>
{% endblock %}
{% block js %}
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script src="{% static 'js/create_compound.js' %}"></script>
  <script>
      $("#id_cas_number").change(function () {
      var cas_number = $(this).val();
      $.ajax({
        url: '{% url "process_cas" %}',
        data: {
            'cas_number': cas_number
        },
        dataType: 'json',
        success: function (data) {
            $("#object_exists").hide();
            if (data.error == 'No compound found for this CAS number')
            {
               alert(data.error);
               console.log(data.error);
            }
            if (data.object_exists)
            {
               $("#object_exists").show();
               $("#object_exists a").attr("href",data.object_exists);
               $("#object_exists a").text(data.object_exists_name);
               alert(data.object_exists);
               console.log(data.object_exists);
            }
            else
            {
                $("#iupac_name").val(data.iupac_name);
                $("#compound_structure").attr('src',data.structure_url);
                $("#id_iupac_name").val(data.iupac_name);
                $("#id_smiles").val(data.smiles);
                $("#hidden_cid").val(data.hidden_cid);
            }
        }
      });
    });
  </script>
{% endblock %}
